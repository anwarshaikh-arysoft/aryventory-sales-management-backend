import{r,j as e,e as J,a as K}from"./app-BP4yl3BC.js";import{c as C,B as S}from"./app-logo-icon-DEZI2dJj.js";import{C as h,a as g,b as _,c as x,d as I}from"./card-Kb3HfW26.js";import{I as H}from"./input-Dq2P0aCI.js";import{B as f}from"./badge-C9qeZdp-.js";import{A as Q,f as W,g as X}from"./app-layout-Cwtnfmx_.js";import{S as Z}from"./separator-rz3D3c4N.js";import{H as ee}from"./heading-VQydfQAI.js";import{c as se,l as te,b as ae,e as ie,M as re,T as ne,a as le,P as ce,L as k}from"./TileLayer-pn8aZBbP.js";import{d as c}from"./dayjs.min-DzUWqRzS.js";import{C as de}from"./calendar-BaWBXnz6.js";import{C as oe,M as w}from"./map-pin-BhbtIOOa.js";import{A as me}from"./activity-CxGBZWqv.js";/* empty css            */import"./index-3KgsdXlp.js";import"./index-B67v5KVH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],xe=C("ArrowLeft",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],ue=C("Coffee",fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],U=C("Navigation",pe),je=se(function({positions:n,...d},o){const i=new te.Polyline(n,d);return ae(i,ie(o,{overlayContainer:i}))},function(n,d,o){d.positions!==o.positions&&n.setLatLngs(d.positions)});delete k.Icon.Default.prototype._getIconUrl;k.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function $e({userId:m,userName:n,userEmail:d,userDesignation:o}){const[i,z]=r.useState(null),[N,M]=r.useState(!1),[u,D]=r.useState(""),[p,Y]=r.useState(""),[t,A]=r.useState(null),[E,v]=r.useState(null),L=async()=>{M(!0);try{const s=new URLSearchParams({user_id:m.toString(),per_page:"50"});u&&s.append("start_date",u),p&&s.append("end_date",p);const a=await K.get(`/api/shift/user-shifts?${s.toString()}`);z(a.data.shifts),a.data.shifts.data.length>0&&!t&&A(a.data.shifts.data[0])}catch(s){console.error("Error fetching user shifts:",s)}M(!1)};r.useEffect(()=>{L()},[m,u,p]),r.useEffect(()=>{const s=c(),a=s.subtract(30,"day");D(a.format("YYYY-MM-DD")),Y(s.format("YYYY-MM-DD"))},[]);const y=s=>s?c(s).format("MMM DD, YYYY HH:mm"):"-",$=s=>s?c(s).format("HH:mm"):"-",T=(s,a)=>{if(!s||!a)return"-";const l=c(a).diff(c(s),"minute"),q=Math.floor(l/60),G=l%60;return`${q}h ${G}m`},j=(s,a=6)=>{if(s==null||s==="")return"N/A";const l=Number(s);return isNaN(l)?"Invalid":l.toFixed(a)},B=s=>s.split(" ").map(a=>a.charAt(0)).join("").toUpperCase().slice(0,2),F=s=>s.shift_start?s.shift_start&&!s.shift_end?s.break_start&&!s.break_end?e.jsx(f,{variant:"secondary",className:"text-xs",children:"On Break"}):e.jsx(f,{variant:"default",className:"text-xs",children:"In Progress"}):s.shift_start&&s.shift_end?e.jsx(f,{variant:"outline",className:"text-xs text-green-600",children:"Completed"}):e.jsx(f,{variant:"destructive",className:"text-xs",children:"Unknown"}):e.jsx(f,{variant:"outline",className:"text-xs",children:"Not Started"}),b=s=>{v(s)},O=()=>t?.shift_start_latitude&&t?.shift_start_longitude?[t.shift_start_latitude,t.shift_start_longitude]:[28.6139,77.209],R=()=>{if(!t)return[];const s=[];return t.shift_start_latitude&&t.shift_start_longitude&&s.push({position:[t.shift_start_latitude,t.shift_start_longitude],type:"start",time:t.shift_start,selfie:t.shift_start_selfie_url}),t.shift_end_latitude&&t.shift_end_longitude&&s.push({position:[t.shift_end_latitude,t.shift_end_longitude],type:"end",time:t.shift_end,selfie:t.shift_end_selfie_url}),s},P=()=>{if(!t)return[];const s=[];return t.shift_start_latitude&&t.shift_start_longitude&&s.push([t.shift_start_latitude,t.shift_start_longitude]),t.shift_end_latitude&&t.shift_end_longitude&&s.push([t.shift_end_latitude,t.shift_end_longitude]),s},V=s=>{const l=`
            <div style="
                background-color: ${s==="start"?"#22c55e":"#ef4444"};
                width: 30px;
                height: 30px;
                border-radius: 50%;
                border: 3px solid white;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            ">
                <span style="color: white; font-weight: bold; font-size: 12px;">
                    ${s==="start"?"S":"E"}
                </span>
            </div>
        `;return k.divIcon({html:l,className:"custom-marker",iconSize:[30,30],iconAnchor:[15,15]})};return e.jsxs(Q,{breadcrumbs:[{title:"Users",href:"/users"},{title:`${n} - Shifts`,href:`/users/${m}/shifts`}],children:[e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>J.visit("/users"),className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Back to Users"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-10 w-10",children:e.jsx(X,{children:B(n)})}),e.jsxs("div",{children:[e.jsx(ee,{title:`${n} - Shift Tracking`}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o&&`${o} • `,d]})]})]})]})}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(_,{className:"text-base",children:"Date Range"})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(H,{type:"date",value:u,onChange:s=>D(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsx(H,{type:"date",value:p,onChange:s=>Y(s.target.value)})]}),e.jsx(S,{onClick:L,className:"w-full",size:"sm",children:"Apply Filter"})]})]}),e.jsxs(h,{children:[e.jsxs(g,{className:"pb-3",children:[e.jsx(_,{className:"text-base",children:"Shift History"}),e.jsxs(I,{children:[i?.total||0," shifts found"]})]}),e.jsxs(x,{className:"space-y-2 max-h-[500px] overflow-y-auto",children:[N&&e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading shifts..."}),!N&&i&&i.data.length===0&&e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No shifts found for the selected period"}),!N&&i&&i.data.map(s=>e.jsxs("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${t?.id===s.id?"border-primary bg-primary/5":"border-border hover:bg-muted/50"}`,onClick:()=>A(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:c(s.shift_date).format("MMM DD, YYYY")})]}),F(s)]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),$(s.shift_start)," - ",$(s.shift_end)]}),s.shift_start_latitude&&s.shift_start_longitude&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"Location Available"]}),s.total_break_mins&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),Math.floor(s.total_break_mins/60),"h ",s.total_break_mins%60,"m break"]})]})]},s.id))]})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:t?e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Shift Details - ",c(t.shift_date).format("MMMM DD, YYYY")]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-green-600",children:"Start Time"}),e.jsx("div",{className:"text-sm",children:y(t.shift_start)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-red-600",children:"End Time"}),e.jsx("div",{className:"text-sm",children:y(t.shift_end)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600",children:"Duration"}),e.jsx("div",{className:"text-sm",children:T(t.shift_start,t.shift_end)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-orange-600",children:"Break Time"}),e.jsx("div",{className:"text-sm",children:t.total_break_mins?`${Math.floor(t.total_break_mins/60)}h ${t.total_break_mins%60}m`:"No breaks"})]})]}),e.jsx(Z,{className:"my-4"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-green-600 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Shift Start"]}),e.jsxs("div",{className:"space-y-2",children:[t.shift_start_latitude&&t.shift_start_longitude?e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Location:"})," ",j(t.shift_start_latitude,4),", ",j(t.shift_start_longitude,4)]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No location data"}),t.shift_start_selfie_url&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Selfie:"}),e.jsx("img",{src:t.shift_start_selfie_url,alt:"Start selfie",className:"w-20 h-20 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>b(t.shift_start_selfie_url)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-red-600 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Shift End"]}),e.jsxs("div",{className:"space-y-2",children:[t.shift_end_latitude&&t.shift_end_longitude?e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Location:"})," ",j(t.shift_end_latitude,4),", ",j(t.shift_end_longitude,4)]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No location data"}),t.shift_end_selfie_url&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Selfie:"}),e.jsx("img",{src:t.shift_end_selfie_url,alt:"End selfie",className:"w-20 h-20 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>b(t.shift_end_selfie_url)})]})]})]})]})]})]}),e.jsxs(h,{children:[e.jsxs(g,{className:"pb-3",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Location Tracking"]}),e.jsx(I,{children:"Visual representation of shift locations and movement"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"h-[400px] rounded-lg overflow-hidden",children:e.jsxs(re,{center:O(),zoom:13,style:{height:"100%",width:"100%"},children:[e.jsx(ne,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),R().map((s,a)=>e.jsx(le,{position:s.position,icon:V(s.type),children:e.jsx(ce,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:s.type==="start"?"Shift Start":"Shift End"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Time:"})," ",y(s.time)]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Coordinates:"}),e.jsx("br",{}),s.position[0],", ",s.position[1]]}),s.selfie&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.selfie,alt:`${s.type} selfie`,className:"w-24 h-24 object-cover rounded cursor-pointer",onClick:()=>b(s.selfie)})})]})})},a)),P().length>1&&e.jsx(je,{positions:P(),color:"#3b82f6",weight:3,opacity:.7,dashArray:"5, 10"})]})}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),e.jsx("span",{children:"Shift Start"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{children:"Shift End"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-1 bg-blue-500",style:{borderStyle:"dashed"}}),e.jsx("span",{children:"Movement Path"})]})]})]})]})]}):e.jsx(h,{children:e.jsx(x,{className:"py-12",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Shift"}),e.jsx("p",{children:"Choose a shift from the list to view detailed information and location tracking"})]})})})})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:()=>v(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] p-4",children:[e.jsx("img",{src:E,alt:"Shift selfie",className:"max-w-full max-h-full object-contain rounded"}),e.jsx(S,{variant:"secondary",size:"sm",className:"absolute top-2 right-2",onClick:()=>v(null),children:"✕"})]})})]})}export{$e as default};

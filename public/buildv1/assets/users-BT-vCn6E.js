import{r as n,j as e,a as M,e as bs}from"./app-BP4yl3BC.js";import{c as xe,B as C,u as Ie,a as pe}from"./app-logo-icon-DEZI2dJj.js";import{C as J,a as Ee,b as Te,c as ee,d as ys}from"./card-Kb3HfW26.js";import{I as F}from"./input-Dq2P0aCI.js";import{a as K,b as W,c as q,d as H,e as P,P as Ss,S as Cs}from"./select-D0kngPwl.js";import{B as U}from"./badge-C9qeZdp-.js";import{c as Is,u as Pe,a as Ae,h as Es,U as Fe,f as de,g as me,X as Ts,A as Ps}from"./app-layout-Cwtnfmx_.js";import{H as As}from"./heading-VQydfQAI.js";import{D as se,a as te,b as ae,c as re,d as ge,e as Re}from"./dialog-CnCDzEzS.js";import{L as R}from"./label-CVruneVp.js";import{c as Me,u as Ue,b as ye}from"./index-3KgsdXlp.js";import{P as Y}from"./index-B67v5KVH.js";import{A as Se}from"./activity-CxGBZWqv.js";import{M as Ce,C as ke}from"./map-pin-BhbtIOOa.js";import{C as Fs,E as Rs,U as Ms}from"./user-shifts-modal-BPUqUpR5.js";import{C as Us}from"./circle-check-big-CKjdH_HY.js";import{P as ks}from"./pen-Br02OG8S.js";import{T as Ds}from"./trash-2-6HQcmOCw.js";/* empty css            */import"./index-CFvp7uWT.js";import"./calendar-BaWBXnz6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ls=xe("CircleAlert",Os);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Vs=xe("Key",Gs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Bs=xe("Pause",$s);function zs({isOpen:a,onClose:t,onSave:l,user:i,roles:u,groups:w,managers:p}){const[c,j]=n.useState({name:"",email:"",phone:"",designation:"",role_id:"",group_id:"",manager_id:"",password:"",password_confirmation:""}),[f,d]=n.useState({}),[x,_]=n.useState(!1),g=!!i;n.useEffect(()=>{a&&(j(i?{name:i.name||"",email:i.email||"",phone:i.phone||"",designation:i.designation||"",role_id:i.role_id?.toString()||"",group_id:i.group_id?.toString()||"",manager_id:i.manager_id?.toString()||"",password:"",password_confirmation:""}:{name:"",email:"",phone:"",designation:"",role_id:"",group_id:"",manager_id:"",password:"",password_confirmation:""}),d({}))},[a,i]);const h=(o,N)=>{j(I=>({...I,[o]:N})),f[o]&&d(I=>({...I,[o]:[]}))},b=()=>{const o={};return c.name.trim()||(o.name=["Name is required"]),c.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)||(o.email=["Please enter a valid email address"]):o.email=["Email is required"],g||(c.password?c.password.length<6&&(o.password=["Password must be at least 6 characters"]):o.password=["Password is required"],c.password!==c.password_confirmation&&(o.password_confirmation=["Passwords do not match"])),d(o),Object.keys(o).length===0},v=async o=>{if(o.preventDefault(),!!b()){_(!0);try{const N={name:c.name,email:c.email,phone:c.phone||null,designation:c.designation||null,role_id:c.role_id&&c.role_id!=="none"?parseInt(c.role_id):null,group_id:c.group_id&&c.group_id!=="none"?parseInt(c.group_id):null,manager_id:c.manager_id&&c.manager_id!=="none"?parseInt(c.manager_id):null};!g&&c.password&&(N.password=c.password),g&&i?await M.put(`/api/users/${i.id}`,N):await M.post("/api/users",N),l()}catch(N){console.error("Error saving user:",N),N.response?.status===422&&N.response?.data?.errors?d(N.response.data.errors):d({general:["An error occurred while saving the user. Please try again."]})}_(!1)}},m=o=>f[o]?.[0]||"";return e.jsx(se,{open:a,onOpenChange:t,children:e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:g?"Edit User":"Add New User"}),e.jsx(ge,{children:g?"Update the user information below.":"Fill in the details to create a new user account."})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[f.general&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:f.general[0]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"name",children:"Name *"}),e.jsx(F,{id:"name",value:c.name,onChange:o=>h("name",o.target.value),placeholder:"Enter full name",className:m("name")?"border-red-500":""}),m("name")&&e.jsx("p",{className:"text-sm text-red-600",children:m("name")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"email",children:"Email *"}),e.jsx(F,{id:"email",type:"email",value:c.email,onChange:o=>h("email",o.target.value),placeholder:"Enter email address",className:m("email")?"border-red-500":""}),m("email")&&e.jsx("p",{className:"text-sm text-red-600",children:m("email")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"phone",children:"Phone"}),e.jsx(F,{id:"phone",value:c.phone,onChange:o=>h("phone",o.target.value),placeholder:"Enter phone number",className:m("phone")?"border-red-500":""}),m("phone")&&e.jsx("p",{className:"text-sm text-red-600",children:m("phone")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"designation",children:"Designation"}),e.jsx(F,{id:"designation",value:c.designation,onChange:o=>h("designation",o.target.value),placeholder:"Enter job designation",className:m("designation")?"border-red-500":""}),m("designation")&&e.jsx("p",{className:"text-sm text-red-600",children:m("designation")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"role",children:"Role"}),e.jsxs(K,{value:c.role_id,onValueChange:o=>h("role_id",o),children:[e.jsx(W,{className:m("role_id")?"border-red-500":"",children:e.jsx(q,{placeholder:"Select a role"})}),e.jsxs(H,{children:[e.jsx(P,{value:"none",children:"No role"}),u.map(o=>e.jsx(P,{value:o.id.toString(),children:o.name},o.id))]})]}),m("role_id")&&e.jsx("p",{className:"text-sm text-red-600",children:m("role_id")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"group",children:"Group"}),e.jsxs(K,{value:c.group_id,onValueChange:o=>h("group_id",o),children:[e.jsx(W,{className:m("group_id")?"border-red-500":"",children:e.jsx(q,{placeholder:"Select a group"})}),e.jsxs(H,{children:[e.jsx(P,{value:"none",children:"No group"}),w.map(o=>e.jsx(P,{value:o.id.toString(),children:o.name},o.id))]})]}),m("group_id")&&e.jsx("p",{className:"text-sm text-red-600",children:m("group_id")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"manager",children:"Manager"}),e.jsxs(K,{value:c.manager_id,onValueChange:o=>h("manager_id",o),children:[e.jsx(W,{className:m("manager_id")?"border-red-500":"",children:e.jsx(q,{placeholder:"Select a manager"})}),e.jsxs(H,{children:[e.jsx(P,{value:"none",children:"No manager"}),p.map(o=>e.jsx(P,{value:o.id.toString(),children:o.name},o.id))]})]}),m("manager_id")&&e.jsx("p",{className:"text-sm text-red-600",children:m("manager_id")})]}),!g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"password",children:"Password *"}),e.jsx(F,{id:"password",type:"password",value:c.password||"",onChange:o=>h("password",o.target.value),placeholder:"Enter password",className:m("password")?"border-red-500":""}),m("password")&&e.jsx("p",{className:"text-sm text-red-600",children:m("password")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"password_confirmation",children:"Confirm Password *"}),e.jsx(F,{id:"password_confirmation",type:"password",value:c.password_confirmation||"",onChange:o=>h("password_confirmation",o.target.value),placeholder:"Confirm password",className:m("password_confirmation")?"border-red-500":""}),m("password_confirmation")&&e.jsx("p",{className:"text-sm text-red-600",children:m("password_confirmation")})]})]}),e.jsxs(Re,{className:"gap-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:t,disabled:x,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:x,children:x?"Saving...":g?"Update User":"Create User"})]})]})]})})}function Ks({isOpen:a,onClose:t,onSuccess:l,user:i}){const[u,w]=n.useState({password:"",password_confirmation:""}),[p,c]=n.useState({}),[j,f]=n.useState(!1);n.useEffect(()=>{a&&(w({password:"",password_confirmation:""}),c({}))},[a]);const d=(h,b)=>{w(v=>({...v,[h]:b})),p[h]&&c(v=>({...v,[h]:[]}))},x=()=>{const h={};return u.password?u.password.length<6&&(h.password=["Password must be at least 6 characters"]):h.password=["Password is required"],u.password!==u.password_confirmation&&(h.password_confirmation=["Passwords do not match"]),c(h),Object.keys(h).length===0},_=async h=>{if(h.preventDefault(),!!i&&x()){f(!0);try{await M.put(`/api/users/${i.id}/password`,{password:u.password}),l(),t()}catch(b){console.error("Error updating password:",b),b.response?.status===422&&b.response?.data?.errors?c(b.response.data.errors):c({general:["An error occurred while updating the password. Please try again."]})}f(!1)}},g=h=>p[h]?.[0]||"";return e.jsx(se,{open:a,onOpenChange:t,children:e.jsxs(te,{className:"sm:max-w-[400px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Change Password"}),e.jsxs(ge,{children:["Change the password for ",i?.name,". The user will need to use the new password to log in."]})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[p.general&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:p.general[0]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"password",children:"New Password *"}),e.jsx(F,{id:"password",type:"password",value:u.password,onChange:h=>d("password",h.target.value),placeholder:"Enter new password",className:g("password")?"border-red-500":""}),g("password")&&e.jsx("p",{className:"text-sm text-red-600",children:g("password")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"password_confirmation",children:"Confirm Password *"}),e.jsx(F,{id:"password_confirmation",type:"password",value:u.password_confirmation,onChange:h=>d("password_confirmation",h.target.value),placeholder:"Confirm new password",className:g("password_confirmation")?"border-red-500":""}),g("password_confirmation")&&e.jsx("p",{className:"text-sm text-red-600",children:g("password_confirmation")})]}),e.jsxs(Re,{className:"gap-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:t,disabled:j,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:j,children:j?"Updating...":"Update Password"})]})]})]})})}function D(a,t,{checkForDefaultPrevented:l=!0}={}){return function(u){if(a?.(u),l===!1||!u.defaultPrevented)return t?.(u)}}var ce="rovingFocusGroup.onEntryFocus",Ws={bubbles:!1,cancelable:!0},Q="RovingFocusGroup",[ue,De,qs]=Is(Q),[Hs,Oe]=Me(Q,[qs]),[Ys,Xs]=Hs(Q),Le=n.forwardRef((a,t)=>e.jsx(ue.Provider,{scope:a.__scopeRovingFocusGroup,children:e.jsx(ue.Slot,{scope:a.__scopeRovingFocusGroup,children:e.jsx(Js,{...a,ref:t})})}));Le.displayName=Q;var Js=n.forwardRef((a,t)=>{const{__scopeRovingFocusGroup:l,orientation:i,loop:u=!1,dir:w,currentTabStopId:p,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:j,onEntryFocus:f,preventScrollOnEntryFocus:d=!1,...x}=a,_=n.useRef(null),g=Ie(t,_),h=Ae(w),[b,v]=Ue({prop:p,defaultProp:c??null,onChange:j,caller:Q}),[m,o]=n.useState(!1),N=Es(f),I=De(l),V=n.useRef(!1),[$,B]=n.useState(0);return n.useEffect(()=>{const y=_.current;if(y)return y.addEventListener(ce,N),()=>y.removeEventListener(ce,N)},[N]),e.jsx(Ys,{scope:l,orientation:i,dir:h,loop:u,currentTabStopId:b,onItemFocus:n.useCallback(y=>v(y),[v]),onItemShiftTab:n.useCallback(()=>o(!0),[]),onFocusableItemAdd:n.useCallback(()=>B(y=>y+1),[]),onFocusableItemRemove:n.useCallback(()=>B(y=>y-1),[]),children:e.jsx(Y.div,{tabIndex:m||$===0?-1:0,"data-orientation":i,...x,ref:g,style:{outline:"none",...a.style},onMouseDown:D(a.onMouseDown,()=>{V.current=!0}),onFocus:D(a.onFocus,y=>{const O=!V.current;if(y.target===y.currentTarget&&O&&!m){const A=new CustomEvent(ce,Ws);if(y.currentTarget.dispatchEvent(A),!A.defaultPrevented){const L=I().filter(S=>S.focusable),z=L.find(S=>S.active),G=L.find(S=>S.id===b),T=[z,G,...L].filter(Boolean).map(S=>S.ref.current);$e(T,d)}}V.current=!1}),onBlur:D(a.onBlur,()=>o(!1))})})}),Ge="RovingFocusGroupItem",Ve=n.forwardRef((a,t)=>{const{__scopeRovingFocusGroup:l,focusable:i=!0,active:u=!1,tabStopId:w,children:p,...c}=a,j=Pe(),f=w||j,d=Xs(Ge,l),x=d.currentTabStopId===f,_=De(l),{onFocusableItemAdd:g,onFocusableItemRemove:h,currentTabStopId:b}=d;return n.useEffect(()=>{if(i)return g(),()=>h()},[i,g,h]),e.jsx(ue.ItemSlot,{scope:l,id:f,focusable:i,active:u,children:e.jsx(Y.span,{tabIndex:x?0:-1,"data-orientation":d.orientation,...c,ref:t,onMouseDown:D(a.onMouseDown,v=>{i?d.onItemFocus(f):v.preventDefault()}),onFocus:D(a.onFocus,()=>d.onItemFocus(f)),onKeyDown:D(a.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){d.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const m=et(v,d.orientation,d.dir);if(m!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let N=_().filter(I=>I.focusable).map(I=>I.ref.current);if(m==="last")N.reverse();else if(m==="prev"||m==="next"){m==="prev"&&N.reverse();const I=N.indexOf(v.currentTarget);N=d.loop?st(N,I+1):N.slice(I+1)}setTimeout(()=>$e(N))}}),children:typeof p=="function"?p({isCurrentTabStop:x,hasTabStop:b!=null}):p})})});Ve.displayName=Ge;var Qs={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Zs(a,t){return t!=="rtl"?a:a==="ArrowLeft"?"ArrowRight":a==="ArrowRight"?"ArrowLeft":a}function et(a,t,l){const i=Zs(a.key,l);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return Qs[i]}function $e(a,t=!1){const l=document.activeElement;for(const i of a)if(i===l||(i.focus({preventScroll:t}),document.activeElement!==l))return}function st(a,t){return a.map((l,i)=>a[(t+i)%a.length])}var tt=Le,at=Ve;function rt(a,t){return n.useReducer((l,i)=>t[l][i]??l,a)}var Be=a=>{const{present:t,children:l}=a,i=nt(t),u=typeof l=="function"?l({present:i.isPresent}):n.Children.only(l),w=Ie(i.ref,it(u));return typeof l=="function"||i.isPresent?n.cloneElement(u,{ref:w}):null};Be.displayName="Presence";function nt(a){const[t,l]=n.useState(),i=n.useRef(null),u=n.useRef(a),w=n.useRef("none"),p=a?"mounted":"unmounted",[c,j]=rt(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return n.useEffect(()=>{const f=Z(i.current);w.current=c==="mounted"?f:"none"},[c]),ye(()=>{const f=i.current,d=u.current;if(d!==a){const _=w.current,g=Z(f);a?j("MOUNT"):g==="none"||f?.display==="none"?j("UNMOUNT"):j(d&&_!==g?"ANIMATION_OUT":"UNMOUNT"),u.current=a}},[a,j]),ye(()=>{if(t){let f;const d=t.ownerDocument.defaultView??window,x=g=>{const b=Z(i.current).includes(CSS.escape(g.animationName));if(g.target===t&&b&&(j("ANIMATION_END"),!u.current)){const v=t.style.animationFillMode;t.style.animationFillMode="forwards",f=d.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=v)})}},_=g=>{g.target===t&&(w.current=Z(i.current))};return t.addEventListener("animationstart",_),t.addEventListener("animationcancel",x),t.addEventListener("animationend",x),()=>{d.clearTimeout(f),t.removeEventListener("animationstart",_),t.removeEventListener("animationcancel",x),t.removeEventListener("animationend",x)}}else j("ANIMATION_END")},[t,j]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:n.useCallback(f=>{i.current=f?getComputedStyle(f):null,l(f)},[])}}function Z(a){return a?.animationName||"none"}function it(a){let t=Object.getOwnPropertyDescriptor(a.props,"ref")?.get,l=t&&"isReactWarning"in t&&t.isReactWarning;return l?a.ref:(t=Object.getOwnPropertyDescriptor(a,"ref")?.get,l=t&&"isReactWarning"in t&&t.isReactWarning,l?a.props.ref:a.props.ref||a.ref)}var ne="Tabs",[ot,Rt]=Me(ne,[Oe]),ze=Oe(),[lt,je]=ot(ne),Ke=n.forwardRef((a,t)=>{const{__scopeTabs:l,value:i,onValueChange:u,defaultValue:w,orientation:p="horizontal",dir:c,activationMode:j="automatic",...f}=a,d=Ae(c),[x,_]=Ue({prop:i,onChange:u,defaultProp:w??"",caller:ne});return e.jsx(lt,{scope:l,baseId:Pe(),value:x,onValueChange:_,orientation:p,dir:d,activationMode:j,children:e.jsx(Y.div,{dir:d,"data-orientation":p,...f,ref:t})})});Ke.displayName=ne;var We="TabsList",qe=n.forwardRef((a,t)=>{const{__scopeTabs:l,loop:i=!0,...u}=a,w=je(We,l),p=ze(l);return e.jsx(tt,{asChild:!0,...p,orientation:w.orientation,dir:w.dir,loop:i,children:e.jsx(Y.div,{role:"tablist","aria-orientation":w.orientation,...u,ref:t})})});qe.displayName=We;var He="TabsTrigger",Ye=n.forwardRef((a,t)=>{const{__scopeTabs:l,value:i,disabled:u=!1,...w}=a,p=je(He,l),c=ze(l),j=Qe(p.baseId,i),f=Ze(p.baseId,i),d=i===p.value;return e.jsx(at,{asChild:!0,...c,focusable:!u,active:d,children:e.jsx(Y.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":f,"data-state":d?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:j,...w,ref:t,onMouseDown:D(a.onMouseDown,x=>{!u&&x.button===0&&x.ctrlKey===!1?p.onValueChange(i):x.preventDefault()}),onKeyDown:D(a.onKeyDown,x=>{[" ","Enter"].includes(x.key)&&p.onValueChange(i)}),onFocus:D(a.onFocus,()=>{const x=p.activationMode!=="manual";!d&&!u&&x&&p.onValueChange(i)})})})});Ye.displayName=He;var Xe="TabsContent",Je=n.forwardRef((a,t)=>{const{__scopeTabs:l,value:i,forceMount:u,children:w,...p}=a,c=je(Xe,l),j=Qe(c.baseId,i),f=Ze(c.baseId,i),d=i===c.value,x=n.useRef(d);return n.useEffect(()=>{const _=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(_)},[]),e.jsx(Be,{present:u||d,children:({present:_})=>e.jsx(Y.div,{"data-state":d?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":j,hidden:!_,id:f,tabIndex:0,...p,ref:t,style:{...a.style,animationDuration:x.current?"0s":void 0},children:_&&w})})});Je.displayName=Xe;function Qe(a,t){return`${a}-trigger-${t}`}function Ze(a,t){return`${a}-content-${t}`}var ct=Ke,es=qe,ss=Ye,ts=Je;const dt=ct,as=n.forwardRef(({className:a,...t},l)=>e.jsx(es,{ref:l,className:pe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t}));as.displayName=es.displayName;const he=n.forwardRef(({className:a,...t},l)=>e.jsx(ss,{ref:l,className:pe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...t}));he.displayName=ss.displayName;const fe=n.forwardRef(({className:a,...t},l)=>e.jsx(ts,{ref:l,className:pe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t}));fe.displayName=ts.displayName;function mt({isOpen:a,onClose:t}){const[l,i]=n.useState(null),[u,w]=n.useState([]),[p,c]=n.useState(!1),[j,f]=n.useState(!1),[d,x]=n.useState(""),[_,g]=n.useState(""),[h,b]=n.useState(""),[v,m]=n.useState(1),[o,N]=n.useState(null),[I,V]=n.useState("current"),$=async()=>{f(!0);try{const s=await M.get("/api/shift/current-status");w(s.data.current_shifts||[])}catch(s){console.error("Error fetching current status:",s),w([])}f(!1)},B=async()=>{c(!0);try{const s=new URLSearchParams({page:v.toString(),per_page:"20"});d&&s.append("start_date",d),_&&s.append("end_date",_),h&&s.append("user_id",h);const T=await M.get(`/api/shift/all-users-shifts?${s.toString()}`);i(T.data.shifts)}catch(s){console.error("Error fetching all shifts:",s)}c(!1)};n.useEffect(()=>{a&&($(),B())},[a,v,d,_,h]);const y=s=>s?new Date(s).toLocaleString():"-",O=s=>{const T=Math.floor(s/60),S=s%60;return`${T}h ${S}m`},A=(s,T=6)=>{if(s==null||s==="")return"N/A";const S=Number(s);return isNaN(S)?"Invalid":S.toFixed(T)},L=s=>s.split(" ").map(T=>T.charAt(0)).join("").toUpperCase().slice(0,2),z=s=>{const T={active:{variant:"default",icon:Se,color:"text-green-600"},break:{variant:"secondary",icon:Bs,color:"text-orange-600"},completed:{variant:"outline",icon:Us,color:"text-blue-600"},offline:{variant:"destructive",icon:Ls,color:"text-red-600"}},S=T[s]||T.offline,ie=S.icon;return e.jsxs(U,{variant:S.variant,className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),s==="active"?"Working":s==="break"?"On Break":s==="completed"?"Completed":"Offline"]})},G=s=>{N(s)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:a,onOpenChange:t,children:e.jsxs(te,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Users Shift Management"]}),e.jsx(ge,{children:"Monitor all users' shift status, history, locations, and selfie verification"})]}),e.jsxs(dt,{value:I,onValueChange:V,className:"w-full",children:[e.jsxs(as,{className:"grid w-full grid-cols-2",children:[e.jsx(he,{value:"current",children:"Current Status"}),e.jsx(he,{value:"history",children:"Shift History"})]}),e.jsx(fe,{value:"current",className:"space-y-4",children:e.jsxs(J,{children:[e.jsx(Ee,{children:e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Real-time Shift Status"]})}),e.jsxs(ee,{children:[j&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading current status..."})}),!j&&u.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active shifts found for today"}),!j&&u.length>0&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:u.map(s=>e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-10 w-10",children:e.jsx(me,{className:"text-sm",children:L(s.user.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user.designation||"No designation"})]}),z(s.status)]}),s.current_activity&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.current_activity}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Work:"})," ",O(s.work_duration)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Break:"})," ",O(s.break_duration)]})]}),s.shift.shift_start_latitude&&s.shift.shift_start_longitude&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Location: ",A(s.shift.shift_start_latitude,4),", ",A(s.shift.shift_start_longitude,4)]}),e.jsxs("div",{className:"flex gap-2",children:[s.shift.shift_start_selfie_url&&e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:s.shift.shift_start_selfie_url,alt:"Start selfie",className:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>G(s.shift.shift_start_selfie_url)}),e.jsx(U,{variant:"outline",className:"text-xs mt-1",children:"Start"})]}),s.shift.shift_end_selfie_url&&e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:s.shift.shift_end_selfie_url,alt:"End selfie",className:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>G(s.shift.shift_end_selfie_url)}),e.jsx(U,{variant:"outline",className:"text-xs mt-1",children:"End"})]})]})]})},s.user.id))})]})]})}),e.jsxs(fe,{value:"history",className:"space-y-4",children:[e.jsx(J,{children:e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(F,{type:"date",value:d,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsx(F,{type:"date",value:_,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"User ID"}),e.jsx(F,{type:"number",placeholder:"Filter by user ID",value:h,onChange:s=>b(s.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(C,{onClick:B,className:"w-full",children:"Apply Filters"})})]})})}),p&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading shift history..."})}),!p&&l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:l.data.map(s=>e.jsx(J,{children:e.jsx(ee,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-8 w-8",children:e.jsx(me,{className:"text-xs",children:L(s.user.name)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user.designation||"No designation"})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Date:"})," ",new Date(s.shift_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Timings"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Start:"})," ",y(s.shift_start)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"End:"})," ",y(s.shift_end)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Duration:"})," ",s.shift_start&&s.shift_end?O(Math.floor((new Date(s.shift_end).getTime()-new Date(s.shift_start).getTime())/(1e3*60))):"-"]}),s.total_break_mins&&e.jsxs("div",{children:[e.jsx("strong",{children:"Break:"})," ",O(s.total_break_mins)]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Locations"]}),s.shift_start_latitude&&s.shift_start_longitude&&e.jsxs("div",{children:[e.jsx("strong",{children:"Start:"})," ",A(s.shift_start_latitude),", ",A(s.shift_start_longitude)]}),s.shift_end_latitude&&s.shift_end_longitude&&e.jsxs("div",{children:[e.jsx("strong",{children:"End:"})," ",A(s.shift_end_latitude),", ",A(s.shift_end_longitude)]}),(!s.shift_start_latitude||!s.shift_start_longitude)&&(!s.shift_end_latitude||!s.shift_end_longitude)&&e.jsx("div",{className:"text-muted-foreground",children:"No location data"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),"Selfies"]}),e.jsxs("div",{className:"flex gap-2",children:[s.shift_start_selfie_url&&e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:s.shift_start_selfie_url,alt:"Start selfie",className:"w-16 h-16 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>G(s.shift_start_selfie_url)}),e.jsx(U,{variant:"outline",className:"text-xs mt-1",children:"Start"})]}),s.shift_end_selfie_url&&e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:s.shift_end_selfie_url,alt:"End selfie",className:"w-16 h-16 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>G(s.shift_end_selfie_url)}),e.jsx(U,{variant:"outline",className:"text-xs mt-1",children:"End"})]}),!s.shift_start_selfie_url&&!s.shift_end_selfie_url&&e.jsx("div",{className:"text-muted-foreground text-sm",children:"No selfies"})]})]})]})})},s.id))}),l.last_page>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>m(v-1),disabled:l.current_page===1,children:"Previous"}),e.jsxs("span",{className:"flex items-center px-3 text-sm",children:["Page ",l.current_page," of ",l.last_page]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>m(v+1),disabled:l.current_page===l.last_page,children:"Next"})]}),l.data.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No shift history found for the selected criteria"})]})]})]})]})}),o&&e.jsx(se,{open:!!o,onOpenChange:()=>N(null),children:e.jsxs(te,{className:"max-w-3xl",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Shift Selfie"}),e.jsx(C,{variant:"ghost",size:"sm",className:"absolute right-4 top-4",onClick:()=>N(null),children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:o,alt:"Shift selfie",className:"max-w-full max-h-[70vh] object-contain rounded"})})]})})]})}function Mt(a){const[t,l]=n.useState(null),[i,u]=n.useState([]),[w,p]=n.useState([]),[c,j]=n.useState([]),[f,d]=n.useState(!0),[x,_]=n.useState(""),[g,h]=n.useState(""),[b,v]=n.useState(""),[m,o]=n.useState(1),[N,I]=n.useState(10),[V,$]=n.useState(!1),[B,y]=n.useState(null),[O,A]=n.useState(!1),[L,z]=n.useState(null),[G,s]=n.useState(!1),[T,S]=n.useState(!1),[ie,ve]=n.useState(null),[rs,ns]=n.useState({}),oe=async()=>{d(!0);try{const r=new URLSearchParams({page:m.toString(),per_page:N.toString()});x&&(r.append("name",x),r.append("email",x)),g&&r.append("role_id",g),b&&r.append("group_id",b),console.log(`/api/users?${r.toString()}`);const E=await M.get(`/api/users?${r.toString()}`);l(E.data)}catch(r){console.error("Error fetching users:",r)}d(!1)};console.log(t);const is=async()=>{try{const[r,E,k]=await Promise.all([M.get("/api/roles"),M.get("/api/groups"),M.get("/api/users-managers")]);u(r.data.data||r.data),p(E.data.data||E.data),j(k.data)}catch(r){console.error("Error fetching roles, groups, and managers:",r)}},Ne=async()=>{try{const r=await M.get("/api/shift/current-status"),E={};r.data.current_shifts.forEach(k=>{E[k.user.id]=k}),ns(E)}catch(r){console.error("Error fetching current shift statuses:",r)}};n.useEffect(()=>{is(),Ne()},[]),n.useEffect(()=>{oe()},[m,N,x,g,b]),n.useEffect(()=>{const r=setInterval(()=>{Ne()},3e4);return()=>clearInterval(r)},[]);const os=r=>{_(r),o(1)},ls=r=>{h(r==="all"?"":r),o(1)},cs=r=>{v(r==="all"?"":r),o(1)},ds=()=>{y(null),$(!0)},ms=r=>{y(r),$(!0)},us=async r=>{if(confirm("Are you sure you want to delete this user?"))try{await M.delete(`/api/users/${r}`),oe()}catch(E){console.error("Error deleting user:",E)}},we=()=>{$(!1),y(null)},hs=()=>{oe(),we()},fs=r=>{z(r),A(!0)},_e=()=>{A(!1),z(null)},xs=()=>{_e()},ps=()=>{s(!0)},gs=r=>{ve(r),S(!0)},js=r=>{bs.visit(`/users/${r}/shifts`)},be=()=>{s(!1),S(!1),ve(null)},vs=()=>{if(!t)return[];const r=[],E=t.last_page,k=t.current_page,X=Math.max(1,k-2),_s=Math.min(E,X+4);for(let le=X;le<=_s;le++)r.push(le);return r},Ns=r=>r.split(" ").map(E=>E.charAt(0)).join("").toUpperCase().slice(0,2),ws=r=>{const E=rs[r];if(!E)return e.jsx(U,{variant:"outline",className:"text-xs",children:"Offline"});const k={active:{variant:"default",text:"Working"},break:{variant:"secondary",text:"On Break"},completed:{variant:"outline",text:"Completed"},offline:{variant:"destructive",text:"Offline"}},X=k[E.status]||k.offline;return e.jsx(U,{variant:X.variant,className:"text-xs",children:X.text})};return e.jsxs(Ps,{breadcrumbs:[{title:"Users",href:"/users"}],children:[e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(As,{title:"Users Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{onClick:ps,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"View All Shifts"]}),e.jsxs(C,{onClick:ds,className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Add User"]})]})]}),e.jsxs(J,{children:[e.jsxs(Ee,{children:[e.jsx(Te,{children:"All Users"}),e.jsx(ys,{children:"Manage user accounts, roles, and groups in your organization."})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Cs,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search by name or email...",value:x,onChange:r=>os(r.target.value),className:"pl-9"})]}),e.jsxs(K,{value:g||"all",onValueChange:ls,children:[e.jsx(W,{className:"w-full sm:w-40",children:e.jsx(q,{placeholder:"Filter by role"})}),e.jsxs(H,{children:[e.jsx(P,{value:"all",children:"All Roles"}),i.map(r=>e.jsx(P,{value:r.id.toString(),children:r.name},r.id))]})]}),e.jsxs(K,{value:b||"all",onValueChange:cs,children:[e.jsx(W,{className:"w-full sm:w-40",children:e.jsx(q,{placeholder:"Filter by group"})}),e.jsxs(H,{children:[e.jsx(P,{value:"all",children:"All Groups"}),w.map(r=>e.jsx(P,{value:r.id.toString(),children:r.name},r.id))]})]})]}),f&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading users..."})}),!f&&t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"User"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Contact"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Role"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Group"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Manager"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Designation"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Shift Status"}),e.jsx("th",{className:"p-3 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:t.data.map(r=>e.jsxs("tr",{className:"border-b hover:bg-muted/25",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-8 w-8",children:e.jsx(me,{className:"text-xs",children:Ns(r.name)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",r.id]})]})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:r.email}),r.phone&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r.phone})]})}),e.jsx("td",{className:"p-3",children:r.role?e.jsx(U,{variant:"secondary",children:r.role.name}):e.jsx("span",{className:"text-muted-foreground",children:"No role"})}),e.jsx("td",{className:"p-3",children:r.group?e.jsx(U,{variant:"outline",children:r.group.name}):e.jsx("span",{className:"text-muted-foreground",children:"No group"})}),e.jsx("td",{className:"p-3",children:r.manager?e.jsx("span",{className:"text-sm font-medium",children:r.manager.name}):e.jsx("span",{className:"text-muted-foreground",children:"No manager"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm",children:r.designation||"-"})}),e.jsx("td",{className:"p-3",children:e.jsx(U,{variant:r.email_verified_at?"default":"destructive",children:r.email_verified_at?"Verified":"Unverified"})}),e.jsx("td",{className:"p-3",children:ws(r.id)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>gs(r.id),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-800",title:"View User Shifts (Modal)",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>js(r.id),className:"h-8 w-8 p-0 text-green-600 hover:text-green-800",title:"View Detailed Shifts Page",children:e.jsx(Rs,{className:"h-4 w-4"})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>ms(r),className:"h-8 w-8 p-0",title:"Edit User",children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>fs(r),className:"h-8 w-8 p-0 text-orange-600 hover:text-orange-700",title:"Change Password",children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>us(r.id),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",title:"Delete User",children:e.jsx(Ds,{className:"h-4 w-4"})})]})})]},r.id))})]})})}),t.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",t.from," to ",t.to," of ",t.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>o(m-1),disabled:t.current_page===1,children:"Previous"}),vs().map(r=>e.jsx(C,{variant:r===t.current_page?"default":"outline",size:"sm",onClick:()=>o(r),className:"h-8 w-8 p-0",children:r},r)),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>o(m+1),disabled:t.current_page===t.last_page,children:"Next"})]})]}),e.jsx("div",{className:"flex items-center justify-between border-t pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Per page:"}),e.jsxs(K,{value:N.toString(),onValueChange:r=>{I(parseInt(r)),o(1)},children:[e.jsx(W,{className:"w-20",children:e.jsx(q,{})}),e.jsxs(H,{children:[e.jsx(P,{value:"5",children:"5"}),e.jsx(P,{value:"10",children:"10"}),e.jsx(P,{value:"25",children:"25"}),e.jsx(P,{value:"50",children:"50"})]})]})]})})]}),!f&&t&&t.data.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"text-muted-foreground",children:"No users found"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Try adjusting your search or filter criteria"})]})]})]})]}),e.jsx(zs,{isOpen:V,onClose:we,onSave:hs,user:B,roles:i,groups:w,managers:c}),e.jsx(Ks,{isOpen:O,onClose:_e,onSuccess:xs,user:L}),e.jsx(mt,{isOpen:G,onClose:be}),e.jsx(Ms,{isOpen:T,onClose:be,userId:ie})]})}export{Mt as default};
